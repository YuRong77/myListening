const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/playQueue-68t_IDgG.js","assets/index-BU_Mq-Jv.js","assets/index-B7RQECNy.css"])))=>i.map(i=>d[i]);
import{d as U,_ as W,c as n,o as a,a as s,b as f,r as w,w as B,e as m,f as q,g as k,h as O,F as b,i as C,t as c,j as M,k as G,l as H,v as J,u as K}from"./index-BU_Mq-Jv.js";import{w as j,u as X}from"./playQueue-68t_IDgG.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y=U("content",{state:()=>({categories:[],loading:!1,error:null,lastLoadedAt:0,manifests:{},manifestLoading:!1,manifestError:null}),actions:{async loadCategories(h=!1){if(!this.loading&&!(!h&&this.categories.length>0)){this.loading=!0,this.error=null;try{const o=await(await fetch((await W(async()=>{const{withBase:_}=await import("./playQueue-68t_IDgG.js").then(u=>u.b);return{withBase:_}},__vite__mapDeps([0,1,2]))).withBase("content/conversation/categories.json"),{headers:{"Cache-Control":"no-cache"}})).json(),g=Array.isArray(o.categories)?o.categories:Array.isArray(o.items)?o.items:[];this.categories=g,this.lastLoadedAt=Date.now()}catch(l){this.error=l?.message||String(l),this.categories=[]}finally{this.loading=!1}}},async loadManifest(h){const l=h.id||h.category_id,o=j(h.manifest||`content/conversation/${l}/manifest.json`),_=await(await fetch(o,{headers:{"Cache-Control":"no-cache"}})).json(),d={items:(Array.isArray(_.items)?_.items:_.dialogues||[]).map(p=>({...p,path:j(p.path||`content/conversation/${l}/${p.id}.json`)})),updated_at:_.updated_at||"",manifestPath:o};return this.manifests[l]=d,d}}}),Z={class:"modal"},ee={class:"head"},se={class:"body"},te={key:0,class:"foot"},oe={__name:"SimpleModal",setup(h){return(l,o)=>(a(),n("div",{class:"overlay",onClick:o[1]||(o[1]=B(g=>l.$emit("close"),["self"]))},[s("div",Z,[s("header",ee,[w(l.$slots,"title",{},void 0),s("button",{class:"x",onClick:o[0]||(o[0]=g=>l.$emit("close"))},"✕")]),s("div",se,[w(l.$slots,"default",{},void 0)]),l.$slots.footer?(a(),n("footer",te,[w(l.$slots,"footer",{},void 0)])):f("",!0)])]))}},ae=z(oe,[["__scopeId","data-v-fceecd17"]]),ne={class:"wrap"},ie={class:"head"},le=["disabled"],ce={key:0,class:"skeleton-grid"},re={key:1,class:"error"},de={key:2,class:"grid"},ue=["onClick"],_e=["data-accent"],he={class:"meta"},ve={class:"title"},pe={class:"subtitle"},fe={key:0,class:"count"},ge={style:{opacity:".75","margin-left":"8px"}},me={class:"toolbar"},ke={class:"opt"},ye=["disabled"],be=["disabled"],Ce=["disabled"],we={key:0,class:"list-skeleton"},$e={key:1,class:"error"},Se={key:2,class:"list"},Ie={class:"row"},Ae=["value","checked","onChange"],Me=["onClick"],je={class:"titles"},Be={class:"en"},ze={key:0,class:"zh"},Ee={class:"meta"},Le={key:0,class:"tag"},Ve={key:1,class:"tag"},xe={key:2,class:"tag"},De={__name:"ConversationView",setup(h){const l=K(),o=Y(),g=X(),_=m(!1),u=m(null),v=m([]),d=m(new Set),p=m(!0);q(()=>{o.loadCategories()});const $=k(()=>o.loading),S=k(()=>o.error),E=k(()=>o.manifestLoading),I=k(()=>o.manifestError),L=k(()=>o.categories);function V(){o.loadCategories(!0)}function A(i=""){return i.replace(/[-_]/g," ").replace(/\b\w/g,t=>t.toUpperCase())}const x={"office-business":"🏢","hr-employment":"💼","calls-meetings":"📞","travel-transport":"✈️","dining-shopping":"🛍️","customer-support":"🎧","finance-banking":"💳","housing-living":"🏠",healthcare:"🏥","education-events":"🎓"};function D(i){return x[i.id]||"📚"}async function T(i){u.value=i,_.value=!0;try{const t=await o.loadManifest(i);v.value=t.items||[]}catch{}}function y(){_.value=!1,u.value=null,v.value=[]}function F(i){const t=(i.path||"").match(/\/content\/conversation\/([^/]+)\/([^/]+)\.json$/),e=t?.[1]||u.value?.id||"unknown",r=t?.[2]||i.id||"unknown";y(),l.push({name:"dialogue",params:{category:e,dialogueId:r}})}function P(i,t){const e=new Set(d.value);t.target.checked?e.add(i):e.delete(i),d.value=e}function N(){const i=new Set;v.value.forEach(t=>i.add(t.id)),d.value=i}function Q(){d.value=new Set}function R(){const i=u?.value?.id||u?.id||"",t=v.value.filter(r=>d.value.has(r.id)).map(r=>({categoryId:i,dialogueId:r.id,title:r.title_en||r.title||r.id,path:r.path}));if(!t.length)return;g.setQueue(t,{speakTitleFirst:p.value});const e=t[0];l.push({name:"dialogue",params:{category:e.categoryId,dialogueId:e.dialogueId}}),typeof y=="function"&&y()}return(i,t)=>(a(),n("section",ne,[s("header",ie,[t[2]||(t[2]=s("h1",null,"對話分類",-1)),s("button",{class:"btn ghost",onClick:V,disabled:$.value},"重新整理",8,le)]),$.value?(a(),n("div",ce,[(a(),n(b,null,C(8,e=>s("div",{class:"skeleton-card",key:e})),64))])):S.value?(a(),n("div",re,[s("p",null,"讀取分類失敗："+c(S.value),1)])):(a(),n("div",de,[(a(!0),n(b,null,C(L.value,e=>(a(),n("button",{key:e.id,class:"card",onClick:r=>T(e)},[s("div",{class:"icon","data-accent":e.accent||""},[s("span",null,c(D(e)),1)],8,_e),s("div",he,[s("div",ve,[s("strong",null,c(e.name_zh||e.name||e.id),1)]),s("div",pe,[s("span",null,c(e.name_en||A(e.id)),1),e.estimated_count?(a(),n("span",fe,"・"+c(e.estimated_count)+" 篇",1)):f("",!0)])])],8,ue))),128))])),_.value?(a(),O(ae,{key:3,onClose:y},{title:M(()=>[s("strong",null,c(u.value?.name_zh||A(u.value?.id)),1),s("small",ge,c(u.value?.name_en),1)]),default:M(()=>[s("div",me,[s("label",ke,[G(s("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e)},null,512),[[J,p.value]]),t[3]||(t[3]=H(" 播放前先念標題 ",-1))]),t[4]||(t[4]=s("div",{class:"spacer"},null,-1)),s("button",{class:"btn ghost",onClick:N,disabled:!v.value.length},"全選",8,ye),s("button",{class:"btn ghost",onClick:Q,disabled:d.value.size===0},"清除",8,be),s("button",{class:"btn primary",onClick:R,disabled:d.value.size===0}," ▶️ 連播選取（"+c(d.value.size)+"） ",9,Ce)]),E.value?(a(),n("div",we,[(a(),n(b,null,C(8,e=>s("div",{class:"s-row",key:e})),64))])):I.value?(a(),n("div",$e," 讀取清單失敗："+c(I.value),1)):(a(),n("ul",Se,[(a(!0),n(b,null,C(v.value,e=>(a(),n("li",{key:e.id},[s("div",Ie,[s("label",{class:"chk",onClick:t[1]||(t[1]=B(()=>{},["stop"]))},[s("input",{type:"checkbox",value:e.id,checked:d.value.has(e.id),onChange:r=>P(e.id,r)},null,40,Ae)]),s("button",{class:"entry",onClick:r=>F(e)},[s("div",je,[s("div",Be,c(e.title_en||e.title||e.id),1),e.title_zh?(a(),n("div",ze,c(e.title_zh),1)):f("",!0)]),s("div",Ee,[e.level?(a(),n("span",Le,c(e.level),1)):f("",!0),e.estimated_duration_sec?(a(),n("span",Ve,c(Math.round(e.estimated_duration_sec/60))+" min ",1)):f("",!0),e.speakers?(a(),n("span",xe,c(e.speakers)+" speakers",1)):f("",!0)])],8,Me)])]))),128))]))]),_:1})):f("",!0),t[5]||(t[5]=s("p",{class:"hint"},"點分類卡片會開啟該分類的對話清單（popup）。",-1))]))}},Ne=z(De,[["__scopeId","data-v-73e6db04"]]);export{Ne as default};
