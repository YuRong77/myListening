import{d as V,c as a,o,a as s,b as _,r as C,w as D,e as $,f as P,g as p,h as W,F as g,i as k,t as r,j as E,u as F}from"./index-CZ93thK6.js";import{w as h}from"./base-url-y7lz57ex.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H=V("content",{state:()=>({categories:[],loading:!1,error:null,lastLoadedAt:0,manifests:{},manifestLoading:!1,manifestError:null}),actions:{async loadCategories(d=!1){if(!this.loading&&!(!d&&this.categories.length>0)){this.loading=!0,this.error=null;try{const t=await fetch(h("content/conversation/categories.json"),{headers:{"Cache-Control":"no-cache"}});if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json();this.categories=Array.isArray(n.categories)?n.categories:Array.isArray(n.items)?n.items:[],this.categories=this.categories.map(i=>({...i,manifest:i.manifest?h(i.manifest):h(`content/conversation/${i.id}/manifest.json`)})),this.lastLoadedAt=Date.now()}catch(t){this.error=t?.message||String(t),this.categories=[]}finally{this.loading=!1}}},async loadManifest(d){const t=d.id||d.category_id,n=d.manifest?d.manifest.startsWith("http")?d.manifest:h(d.manifest):h(`content/conversation/${t}/manifest.json`);if(this.manifests[t]?.items?.length)return this.manifests[t];this.manifestLoading=!0,this.manifestError=null;try{const i=await fetch(n,{headers:{"Cache-Control":"no-cache"}});if(!i.ok)throw new Error(`HTTP ${i.status}`);const l=await i.json(),m={items:(Array.isArray(l.items)?l.items:l.dialogues||[]).map(f=>({...f,path:f.path?h(f.path):h(`content/conversation/${t}/${f.id}.json`)})),updated_at:l.updated_at||"",manifestPath:n};return this.manifests[t]=m,m}catch(i){throw this.manifestError=i?.message||String(i),i}finally{this.manifestLoading=!1}}}}),N={class:"modal"},x={class:"head"},R={class:"body"},U={key:0,class:"foot"},q={__name:"SimpleModal",setup(d){return(t,n)=>(o(),a("div",{class:"overlay",onClick:n[1]||(n[1]=D(i=>t.$emit("close"),["self"]))},[s("div",N,[s("header",x,[C(t.$slots,"title",{},void 0),s("button",{class:"x",onClick:n[0]||(n[0]=i=>t.$emit("close"))},"✕")]),s("div",R,[C(t.$slots,"default",{},void 0)]),t.$slots.footer?(o(),a("footer",U,[C(t.$slots,"footer",{},void 0)])):_("",!0)])]))}},G=A(q,[["__scopeId","data-v-fceecd17"]]),J={class:"wrap"},K={class:"head"},O=["disabled"],Q={key:0,class:"skeleton-grid"},X={key:1,class:"error"},Y={key:2,class:"grid"},Z=["onClick"],ee=["data-accent"],se={class:"meta"},te={class:"title"},ne={class:"subtitle"},oe={key:0,class:"count"},ae={style:{opacity:".75","margin-left":"8px"}},ie={key:0,class:"list-skeleton"},re={key:1,class:"error"},le={key:2,class:"list"},ce=["onClick"],de={class:"titles"},ue={class:"en"},he={key:0,class:"zh"},_e={class:"meta"},fe={key:0,class:"tag"},me={key:1,class:"tag"},pe={key:2,class:"tag"},ve={__name:"ConversationView",setup(d){const t=F(),n=H(),i=$(!1),l=$(null),v=$([]);P(()=>{n.loadCategories()});const y=p(()=>n.loading),m=p(()=>n.error),f=p(()=>n.manifestLoading),b=p(()=>n.manifestError),L=p(()=>n.categories);function S(){n.loadCategories(!0)}function j(u=""){return u.replace(/[-_]/g," ").replace(/\b\w/g,c=>c.toUpperCase())}const B={enterprise:"🏢",meetings:"👥",office:"🗂️",dining:"🍽️",entertainment:"🎬",travel:"✈️",transportation:"🚆",shopping:"🛒",finance:"💳","customer-service":"🎧",education:"🎓",healthcare:"🏥",housing:"🏠"};function z(u){return B[u.id]||"📚"}async function T(u){l.value=u,i.value=!0;try{const c=await n.loadManifest(u);v.value=c.items||[]}catch{}}function M(){i.value=!1,l.value=null,v.value=[]}function I(u){const c=(u.path||"").match(/\/content\/conversation\/([^/]+)\/([^/]+)\.json$/),e=c?.[1]||l.value?.id||"unknown",w=c?.[2]||u.id||"unknown";M(),t.push({name:"dialogue",params:{category:e,dialogueId:w}})}return(u,c)=>(o(),a("section",J,[s("header",K,[c[0]||(c[0]=s("h1",null,"對話分類",-1)),s("button",{class:"btn ghost",onClick:S,disabled:y.value},"重新整理",8,O)]),y.value?(o(),a("div",Q,[(o(),a(g,null,k(8,e=>s("div",{class:"skeleton-card",key:e})),64))])):m.value?(o(),a("div",X,[s("p",null,"讀取分類失敗："+r(m.value),1)])):(o(),a("div",Y,[(o(!0),a(g,null,k(L.value,e=>(o(),a("button",{key:e.id,class:"card",onClick:w=>T(e)},[s("div",{class:"icon","data-accent":e.accent||""},[s("span",null,r(z(e)),1)],8,ee),s("div",se,[s("div",te,[s("strong",null,r(e.name_zh||e.name||e.id),1)]),s("div",ne,[s("span",null,r(e.name_en||j(e.id)),1),e.estimated_count?(o(),a("span",oe,"・"+r(e.estimated_count)+" 篇",1)):_("",!0)])])],8,Z))),128))])),i.value?(o(),W(G,{key:3,onClose:M},{title:E(()=>[s("strong",null,r(l.value?.name_zh||j(l.value?.id)),1),s("small",ae,r(l.value?.name_en),1)]),default:E(()=>[f.value?(o(),a("div",ie,[(o(),a(g,null,k(8,e=>s("div",{class:"s-row",key:e})),64))])):b.value?(o(),a("div",re," 讀取清單失敗："+r(b.value),1)):(o(),a("ul",le,[(o(!0),a(g,null,k(v.value,e=>(o(),a("li",{key:e.id},[s("button",{class:"row",onClick:w=>I(e)},[s("div",de,[s("div",ue,r(e.title_en||e.title||e.id),1),e.title_zh?(o(),a("div",he,r(e.title_zh),1)):_("",!0)]),s("div",_e,[e.level?(o(),a("span",fe,r(e.level),1)):_("",!0),e.estimated_duration_sec?(o(),a("span",me,r(Math.round(e.estimated_duration_sec/60))+" min",1)):_("",!0),e.speakers?(o(),a("span",pe,r(e.speakers)+" speakers",1)):_("",!0)])],8,ce)]))),128))]))]),_:1})):_("",!0),c[1]||(c[1]=s("p",{class:"hint"},"點分類卡片會開啟該分類的對話清單（popup）。",-1))]))}},we=A(ve,[["__scopeId","data-v-cfd26736"]]);export{we as default};
