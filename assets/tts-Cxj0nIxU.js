import{d as l}from"./index-CZ93thK6.js";const f="toeic-tts-settings-v1";function d(){try{const e=localStorage.getItem(f);return e?JSON.parse(e):null}catch{return null}}function a(e){try{localStorage.setItem(f,JSON.stringify(e))}catch{}}function v(){return new Promise(e=>{const n=window.speechSynthesis;let i=n.getVoices();if(i&&i.length){e(i);return}const t=()=>{i=n.getVoices(),e(i||[]),n.removeEventListener?.("voiceschanged",t),"onvoiceschanged"in n&&(n.onvoiceschanged=null)};n.addEventListener?.("voiceschanged",t),"onvoiceschanged"in n&&(n.onvoiceschanged=t),n.getVoices(),setTimeout(t,1200)})}function h(e,n){const i=e.filter(c=>c.lang?.startsWith(n)),t=[],s=new Set;for(const c of i)s.has(c.name)||(t.push(c),s.add(c.name));if(t.length>=2)return[t[0],t[1]];if(t.length===1){const c=e.filter(r=>r.lang?.startsWith("en-")&&r.name!==t[0].name);return c.length?[t[0],c[0]]:[t[0],t[0]]}const o=e.filter(c=>c.lang?.startsWith("en-"));return o.length>=2?[o[0],o[1]]:o.length===1?[o[0],o[0]]:e.length>=2?[e[0],e[1]]:e.length===1?[e[0],e[0]]:[null,null]}const u=l("tts",{state:()=>({rate:1,accent:"en-US",voiceA:"",voiceB:"",voices:[],ready:!1}),getters:{voicesForAccent(e){return e.voices.filter(n=>n.lang?.startsWith(e.accent))},allEnglishVoices(e){return e.voices.filter(n=>n.lang?.startsWith("en-"))}},actions:{async init(){const e=d();e&&(this.rate=e.rate??1,this.accent=e.accent??"en-US",this.voiceA=e.voiceA??"",this.voiceB=e.voiceB??""),await this.refreshVoices(),this.ready=!0,a(this.$state)},async refreshVoices(){const e=await v();this.voices=e||[];const n=this.voices.find(t=>t.name===this.voiceA),i=this.voices.find(t=>t.name===this.voiceB);if(!n||!i){const[t,s]=h(this.voices,this.accent);t&&(this.voiceA=t.name),s&&(this.voiceB=s.name)}a(this.$state)},setRate(e){this.rate=Number(e)||1,a(this.$state)},setAccent(e){this.accent=e;const[n,i]=h(this.voices,this.accent);n&&(this.voiceA=n.name),i&&(this.voiceB=i.name),a(this.$state)},setVoiceA(e){this.voiceA=e,a(this.$state)},setVoiceB(e){this.voiceB=e,a(this.$state)},speak(e,n="A"){if(typeof window>"u"||!("speechSynthesis"in window))return;const i=window.speechSynthesis,t=new SpeechSynthesisUtterance(e);t.rate=this.rate;const s=n==="B"?this.voiceB:this.voiceA,o=this.voices.find(c=>c.name===s)||this.voices.find(c=>c.lang?.startsWith(this.accent))||this.voices.find(c=>c.lang?.startsWith("en-"))||this.voices[0];o&&(t.voice=o),t.lang=o?.lang||this.accent||"en-US",i.cancel(),i.speak(t)},cancel(){typeof window>"u"||!("speechSynthesis"in window)||window.speechSynthesis.cancel()},getVoice(e="A"){const n=e==="B"?this.voiceB:this.voiceA;return this.voices.find(t=>t.name===n)||this.voices.find(t=>t.lang?.startsWith(this.accent))||this.voices.find(t=>t.lang?.startsWith("en-"))||this.voices[0]||null},speak(e,n="A",i={}){if(typeof window>"u"||!("speechSynthesis"in window))return;const t=window.speechSynthesis,s=new SpeechSynthesisUtterance(e);s.rate=this.rate;const o=this.getVoice(n);o?(s.voice=o,s.lang=o.lang):s.lang=this.accent||"en-US",i.onend&&(s.onend=i.onend),i.onstart&&(s.onstart=i.onstart),i.onerror&&(s.onerror=i.onerror),t.cancel(),t.speak(s)}}});export{u};
