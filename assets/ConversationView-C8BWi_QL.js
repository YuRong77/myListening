import{d as I,c as a,o,a as s,b as _,r as k,w as V,e as y,f as D,g as f,h as P,F as v,i as g,t as r,j as M,u as F}from"./index-BcvwZ-pf.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H=I("content",{state:()=>({categories:[],loading:!1,error:null,lastLoadedAt:0,manifests:{},manifestLoading:!1,manifestError:null}),actions:{async loadCategories(u=!1){if(!this.loading&&!(!u&&this.categories.length>0)){this.loading=!0,this.error=null;try{const n=await fetch("/content/conversation/categories.json",{headers:{"Cache-Control":"no-cache"}});if(!n.ok)throw new Error(`HTTP ${n.status}`);const t=await n.json();this.categories=Array.isArray(t.categories)?t.categories:Array.isArray(t.items)?t.items:[],this.lastLoadedAt=Date.now()}catch(n){this.error=n?.message||String(n),this.categories=[]}finally{this.loading=!1}}},async loadManifest(u){const n=u.id||u.category_id,t=u.manifest||`/content/conversation/${n}/manifest.json`;if(this.manifests[n]?.items?.length)return this.manifests[n];this.manifestLoading=!0,this.manifestError=null;try{const i=await fetch(t,{headers:{"Cache-Control":"no-cache"}});if(!i.ok)throw new Error(`HTTP ${i.status}`);const l=await i.json(),h={items:Array.isArray(l.items)?l.items:l.dialogues||[],updated_at:l.updated_at||"",manifestPath:t};return this.manifests[n]=h,h}catch(i){throw this.manifestError=i?.message||String(i),i}finally{this.manifestLoading=!1}}}}),N={class:"modal"},x={class:"head"},R={class:"body"},U={key:0,class:"foot"},q={__name:"SimpleModal",setup(u){return(n,t)=>(o(),a("div",{class:"overlay",onClick:t[1]||(t[1]=V(i=>n.$emit("close"),["self"]))},[s("div",N,[s("header",x,[k(n.$slots,"title",{},void 0),s("button",{class:"x",onClick:t[0]||(t[0]=i=>n.$emit("close"))},"✕")]),s("div",R,[k(n.$slots,"default",{},void 0)]),n.$slots.footer?(o(),a("footer",U,[k(n.$slots,"footer",{},void 0)])):_("",!0)])]))}},G=E(q,[["__scopeId","data-v-fceecd17"]]),J={class:"wrap"},K={class:"head"},O=["disabled"],Q={key:0,class:"skeleton-grid"},W={key:1,class:"error"},X={key:2,class:"grid"},Y=["onClick"],Z=["data-accent"],ee={class:"meta"},se={class:"title"},te={class:"subtitle"},oe={key:0,class:"count"},ne={style:{opacity:".75","margin-left":"8px"}},ae={key:0,class:"list-skeleton"},ie={key:1,class:"error"},re={key:2,class:"list"},le=["onClick"],ce={class:"titles"},de={class:"en"},ue={key:0,class:"zh"},_e={class:"meta"},he={key:0,class:"tag"},fe={key:1,class:"tag"},me={key:2,class:"tag"},ve={__name:"ConversationView",setup(u){const n=F(),t=H(),i=y(!1),l=y(null),m=y([]);D(()=>{t.loadCategories()});const h=f(()=>t.loading),w=f(()=>t.error),j=f(()=>t.manifestLoading),C=f(()=>t.manifestError),A=f(()=>t.categories);function L(){t.loadCategories(!0)}function $(d=""){return d.replace(/[-_]/g," ").replace(/\b\w/g,c=>c.toUpperCase())}const S={enterprise:"🏢",meetings:"👥",office:"🗂️",dining:"🍽️",entertainment:"🎬",travel:"✈️",transportation:"🚆",shopping:"🛒",finance:"💳","customer-service":"🎧",education:"🎓",healthcare:"🏥",housing:"🏠"};function z(d){return S[d.id]||"📚"}async function T(d){l.value=d,i.value=!0;try{const c=await t.loadManifest(d);m.value=c.items||[]}catch{}}function b(){i.value=!1,l.value=null,m.value=[]}function B(d){const c=(d.path||"").match(/\/content\/conversation\/([^/]+)\/([^/]+)\.json$/),e=c?.[1]||l.value?.id||"unknown",p=c?.[2]||d.id||"unknown";b(),n.push({name:"dialogue",params:{category:e,dialogueId:p}})}return(d,c)=>(o(),a("section",J,[s("header",K,[c[0]||(c[0]=s("h1",null,"對話分類",-1)),s("button",{class:"btn ghost",onClick:L,disabled:h.value},"重新整理",8,O)]),h.value?(o(),a("div",Q,[(o(),a(v,null,g(8,e=>s("div",{class:"skeleton-card",key:e})),64))])):w.value?(o(),a("div",W,[s("p",null,"讀取分類失敗："+r(w.value),1)])):(o(),a("div",X,[(o(!0),a(v,null,g(A.value,e=>(o(),a("button",{key:e.id,class:"card",onClick:p=>T(e)},[s("div",{class:"icon","data-accent":e.accent||""},[s("span",null,r(z(e)),1)],8,Z),s("div",ee,[s("div",se,[s("strong",null,r(e.name_zh||e.name||e.id),1)]),s("div",te,[s("span",null,r(e.name_en||$(e.id)),1),e.estimated_count?(o(),a("span",oe,"・"+r(e.estimated_count)+" 篇",1)):_("",!0)])])],8,Y))),128))])),i.value?(o(),P(G,{key:3,onClose:b},{title:M(()=>[s("strong",null,r(l.value?.name_zh||$(l.value?.id)),1),s("small",ne,r(l.value?.name_en),1)]),default:M(()=>[j.value?(o(),a("div",ae,[(o(),a(v,null,g(8,e=>s("div",{class:"s-row",key:e})),64))])):C.value?(o(),a("div",ie," 讀取清單失敗："+r(C.value),1)):(o(),a("ul",re,[(o(!0),a(v,null,g(m.value,e=>(o(),a("li",{key:e.id},[s("button",{class:"row",onClick:p=>B(e)},[s("div",ce,[s("div",de,r(e.title_en||e.title||e.id),1),e.title_zh?(o(),a("div",ue,r(e.title_zh),1)):_("",!0)]),s("div",_e,[e.level?(o(),a("span",he,r(e.level),1)):_("",!0),e.estimated_duration_sec?(o(),a("span",fe,r(Math.round(e.estimated_duration_sec/60))+" min",1)):_("",!0),e.speakers?(o(),a("span",me,r(e.speakers)+" speakers",1)):_("",!0)])],8,le)]))),128))]))]),_:1})):_("",!0),c[1]||(c[1]=s("p",{class:"hint"},"點分類卡片會開啟該分類的對話清單（popup）。",-1))]))}},ke=E(ve,[["__scopeId","data-v-cfd26736"]]);export{ke as default};
