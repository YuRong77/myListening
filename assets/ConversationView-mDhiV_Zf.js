import{d as D,_ as P,c as n,o,a as s,b as _,r as w,w as F,e as C,f as N,g as p,h as R,F as m,i as g,t as r,j,u as T}from"./index-DZ7l0bSN.js";import{withBase as A}from"./base-url-DOLbNoyy.js";import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W=D("content",{state:()=>({categories:[],loading:!1,error:null,lastLoadedAt:0,manifests:{},manifestLoading:!1,manifestError:null}),actions:{async loadCategories(u=!1){if(!this.loading&&!(!u&&this.categories.length>0)){this.loading=!0,this.error=null;try{const t=await(await fetch((await P(async()=>{const{withBase:i}=await import("./base-url-DOLbNoyy.js");return{withBase:i}},[])).withBase("content/conversation/categories.json"),{headers:{"Cache-Control":"no-cache"}})).json(),d=Array.isArray(t.categories)?t.categories:Array.isArray(t.items)?t.items:[];this.categories=d,this.lastLoadedAt=Date.now()}catch(a){this.error=a?.message||String(a),this.categories=[]}finally{this.loading=!1}}},async loadManifest(u){const a=u.id||u.category_id,t=A(u.manifest||`content/conversation/${a}/manifest.json`),i=await(await fetch(t,{headers:{"Cache-Control":"no-cache"}})).json(),h={items:(Array.isArray(i.items)?i.items:i.dialogues||[]).map(f=>({...f,path:A(f.path||`content/conversation/${a}/${f.id}.json`)})),updated_at:i.updated_at||"",manifestPath:t};return this.manifests[a]=h,h}}}),x={class:"modal"},O={class:"head"},U={class:"body"},q={key:0,class:"foot"},G={__name:"SimpleModal",setup(u){return(a,t)=>(o(),n("div",{class:"overlay",onClick:t[1]||(t[1]=F(d=>a.$emit("close"),["self"]))},[s("div",x,[s("header",O,[w(a.$slots,"title",{},void 0),s("button",{class:"x",onClick:t[0]||(t[0]=d=>a.$emit("close"))},"✕")]),s("div",U,[w(a.$slots,"default",{},void 0)]),a.$slots.footer?(o(),n("footer",q,[w(a.$slots,"footer",{},void 0)])):_("",!0)])]))}},H=B(G,[["__scopeId","data-v-fceecd17"]]),J={class:"wrap"},K={class:"head"},Q=["disabled"],X={key:0,class:"skeleton-grid"},Y={key:1,class:"error"},Z={key:2,class:"grid"},ee=["onClick"],se=["data-accent"],te={class:"meta"},oe={class:"title"},ne={class:"subtitle"},ae={key:0,class:"count"},ie={style:{opacity:".75","margin-left":"8px"}},re={key:0,class:"list-skeleton"},le={key:1,class:"error"},ce={key:2,class:"list"},de=["onClick"],ue={class:"titles"},_e={class:"en"},he={key:0,class:"zh"},fe={class:"meta"},pe={key:0,class:"tag"},ve={key:1,class:"tag"},me={key:2,class:"tag"},ge={__name:"ConversationView",setup(u){const a=T(),t=W(),d=C(!1),i=C(null),v=C([]);N(()=>{t.loadCategories()});const k=p(()=>t.loading),h=p(()=>t.error),f=p(()=>t.manifestLoading),$=p(()=>t.manifestError),E=p(()=>t.categories);function L(){t.loadCategories(!0)}function b(c=""){return c.replace(/[-_]/g," ").replace(/\b\w/g,l=>l.toUpperCase())}const S={enterprise:"🏢",meetings:"👥",office:"🗂️",dining:"🍽️",entertainment:"🎬",travel:"✈️",transportation:"🚆",shopping:"🛒",finance:"💳","customer-service":"🎧",education:"🎓",healthcare:"🏥",housing:"🏠"};function z(c){return S[c.id]||"📚"}async function I(c){i.value=c,d.value=!0;try{const l=await t.loadManifest(c);v.value=l.items||[]}catch{}}function M(){d.value=!1,i.value=null,v.value=[]}function V(c){const l=(c.path||"").match(/\/content\/conversation\/([^/]+)\/([^/]+)\.json$/),e=l?.[1]||i.value?.id||"unknown",y=l?.[2]||c.id||"unknown";M(),a.push({name:"dialogue",params:{category:e,dialogueId:y}})}return(c,l)=>(o(),n("section",J,[s("header",K,[l[0]||(l[0]=s("h1",null,"對話分類",-1)),s("button",{class:"btn ghost",onClick:L,disabled:k.value},"重新整理",8,Q)]),k.value?(o(),n("div",X,[(o(),n(m,null,g(8,e=>s("div",{class:"skeleton-card",key:e})),64))])):h.value?(o(),n("div",Y,[s("p",null,"讀取分類失敗："+r(h.value),1)])):(o(),n("div",Z,[(o(!0),n(m,null,g(E.value,e=>(o(),n("button",{key:e.id,class:"card",onClick:y=>I(e)},[s("div",{class:"icon","data-accent":e.accent||""},[s("span",null,r(z(e)),1)],8,se),s("div",te,[s("div",oe,[s("strong",null,r(e.name_zh||e.name||e.id),1)]),s("div",ne,[s("span",null,r(e.name_en||b(e.id)),1),e.estimated_count?(o(),n("span",ae,"・"+r(e.estimated_count)+" 篇",1)):_("",!0)])])],8,ee))),128))])),d.value?(o(),R(H,{key:3,onClose:M},{title:j(()=>[s("strong",null,r(i.value?.name_zh||b(i.value?.id)),1),s("small",ie,r(i.value?.name_en),1)]),default:j(()=>[f.value?(o(),n("div",re,[(o(),n(m,null,g(8,e=>s("div",{class:"s-row",key:e})),64))])):$.value?(o(),n("div",le," 讀取清單失敗："+r($.value),1)):(o(),n("ul",ce,[(o(!0),n(m,null,g(v.value,e=>(o(),n("li",{key:e.id},[s("button",{class:"row",onClick:y=>V(e)},[s("div",ue,[s("div",_e,r(e.title_en||e.title||e.id),1),e.title_zh?(o(),n("div",he,r(e.title_zh),1)):_("",!0)]),s("div",fe,[e.level?(o(),n("span",pe,r(e.level),1)):_("",!0),e.estimated_duration_sec?(o(),n("span",ve,r(Math.round(e.estimated_duration_sec/60))+" min",1)):_("",!0),e.speakers?(o(),n("span",me,r(e.speakers)+" speakers",1)):_("",!0)])],8,de)]))),128))]))]),_:1})):_("",!0),l[1]||(l[1]=s("p",{class:"hint"},"點分類卡片會開啟該分類的對話清單（popup）。",-1))]))}},Ce=B(ge,[["__scopeId","data-v-cfd26736"]]);export{Ce as default};
